var fs = require('fs');
var path = require('path');

function checkVersion(version, product, callback){
  var ver = "941HF5";
  var GA = "941";
  product = product.toString();
  fs.readFile(path.join(appRoot,'public/data/versions', GA + '.json'),function(err,data){
    if(err) throw err;
    var obj = JSON.parse(data);
    var found = {
      "product": product,
      "version": "",
      "status": ""
    };
    for (var key in obj){
      if(key<=version){
        if (obj[key]["Certified"].indexOf(product) >= 0){
          console.log(product + " certified in " + key);
          found.version = key;
          found.status = "certified";
          break;
        }
        else if (obj[key]["Supported"].indexOf(product) >= 0){
          console.log(product + " supported in " + key);
          found.version = key;
          found.status = "supported";
          break;
        }
        else{}
      }
    }

    callback(found);

  });
  
};

module.exports.checkVersion = checkVersion;