var http = require('http');
var fs = require('fs');

function siTKB(term,version,func){
 var tkbURL;
  console.log("IN siTKB");
  fs.readFile('C:/Users/amurphy/Documents/node.js_projects/version_check/data/release_notes.txt',function(err,data){
    if (err) throw err;
    var json = JSON.parse(data);
    
    if(json[version]){
      tkbURL = json[version].URL;
      console.log(tkbURL);
      http.get(tkbURL, function(res){
      console.log("response recieved: " + JSON.stringify(res.body));
      res.on('data', function (chunk) {
        var loc = chunk.toString().toUpperCase().search(term.toString().toUpperCase());
        console.log(loc);
        if (loc > 0) {
          console.log(term + " is found in: " + version);
        }
        else{
          //console.log(chunk.toString());
        }
      });
    func();  // Callback
      });
    }
  });
  
};

module.exports.siTKB = siTKB;